# Система лояльности - Документация

## Тестовый пользователь

**Имя:** Александр Кук
**Телефон:** +79673588200
**Email:** alex.cook@example.com
**Баллы:** 2500
**Уровень:** Золотой

## Как работает система

### Автоматический вход
При первом запуске приложения автоматически создается и загружается тестовый пользователь. Данные сохраняются в `localStorage` и остаются при перезапуске.

### Синхронизация данных
Все изменения данных пользователя (баллы, уровень, профиль) автоматически синхронизируются между всеми страницами приложения через события `userUpdated`.

### Списание баллов
1. На странице оформления заказа (`/order`) отображаются реальные баллы пользователя
2. Можно выбрать количество баллов для списания (до 10% от суммы заказа)
3. При оформлении заказа баллы автоматически списываются с баланса
4. Баллы обновляются во всех компонентах приложения в реальном времени

### Уровни лояльности
- **Бронзовый:** < 500 баллов
- **Серебряный:** 500-1999 баллов
- **Золотой:** 2000-4999 баллов
- **Платиновый:** ≥ 5000 баллов

## API функции (lib/user.ts)

```typescript
// Получить данные пользователя
getUser(): User

// Сохранить данные пользователя
saveUser(user: User): void

// Обновить баллы
updateUserPoints(points: number): void

// Списать баллы
deductUserPoints(points: number): boolean

// Начислить баллы
addUserPoints(points: number): void

// Обновить уровень лояльности
updateLoyaltyLevel(): void

// Обновить аватар пользователя
updateUserAvatar(avatar: string): void

// Конвертировать изображение в base64
imageToBase64(file: File): Promise<string>
```

## Функции профиля

### Загрузка аватарки
1. На страницах профиля (`/account`, `/profile`) есть кнопка с иконкой камеры на аватаре
2. Нажмите на кнопку и выберите изображение
3. Изображение автоматически конвертируется в base64 и сохраняется
4. Аватар синхронизируется на всех страницах приложения
5. Ограничения:
   - Максимальный размер: 5MB
   - Поддерживаемые форматы: все изображения (jpg, png, gif, webp и т.д.)

## Где используется

- **Главная страница** (`/`) - отображение баллов и уровня
- **Личный кабинет** (`/account`, `/profile`) - полная информация о пользователе, загрузка аватарки
- **Оформление заказа** (`/order`) - списание баллов при оплате

## Хранение данных

Все данные пользователя хранятся в `localStorage` под ключом `currentUser`:

```json
{
  "name": "Александр Кук",
  "phone": "+79673588200",
  "email": "alex.cook@example.com",
  "loyaltyPoints": 2500,
  "loyaltyLevel": "Золотой",
  "avatar": "/avatars/01.png"
}
```

## События

### userUpdated
Генерируется при любом изменении данных пользователя. Содержит полный объект User в `detail`.

```javascript
window.addEventListener("userUpdated", (event) => {
  console.log("Пользователь обновлен:", event.detail)
})
```
